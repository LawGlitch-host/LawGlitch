<!DOCTYPE html>
<html lang="en-IN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FREEDOM GLITCH | Indian Retirement Planner</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* === GLITCH THEME STYLES === */
        :root {
            --bg-dark: #000000;
            --primary-red: #FF0000;
            --accent-yellow: #FFD700;
            --panel-bg: rgba(20, 0, 0, 0.9);
            --text-primary: #FFFFFF;
            --text-secondary: #CCCCCC;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Orbitron', 'Roboto Mono', monospace;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            background-image: linear-gradient(45deg, #000000, #1a0000);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            line-height: 1.6;
            padding: 20px;
        }
        
        /* === MATRIX BACKGROUND === */
        #matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
        }
        
        /* === MAIN CONTAINER === */
        .container {
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            padding: 1rem;
            position: relative;
        }
        
        /* === HEADER === */
        header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1rem;
            border-bottom: 1px solid var(--neon-green);
            position: relative;
            overflow: hidden;
        }
        
        h1 {
            font-size: 3rem;
            color: var(--neon-green);
            text-shadow: 0 0 10px var(--neon-green);
            letter-spacing: 0.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
            position: relative;
            animation: glitch 2s linear infinite;
        }
        
        @keyframes glitch {
            0% { text-shadow: 0 0 10px var(--neon-green); }
            25% { text-shadow: 0 0 10px var(--neon-green), 2px 2px 0 var(--cyber-magenta); }
            50% { text-shadow: 0 0 10px var(--neon-green), -2px -2px 0 var(--cyber-cyan); }
            75% { text-shadow: 0 0 10px var(--neon-green), 2px -2px 0 var(--electric-yellow); }
            100% { text-shadow: 0 0 10px var(--neon-green); }
        }
        
        .subtitle {
            color: var(--electric-yellow);
            letter-spacing: 0.2rem;
            font-size: 1.2rem;
            text-shadow: 0 0 5px var(--electric-yellow);
        }
        
        /* === MODULE SELECTOR === */
        .module-selector {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .module-btn {
            background: rgba(255, 0, 0, 0.1);
            color: var(--primary-red);
            border: 1px solid var(--primary-red);
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .module-btn:hover {
            background-color: rgba(51, 255, 87, 0.3);
            box-shadow: 0 0 15px var(--neon-green);
        }
        
        .module-btn.active {
            background-color: var(--primary-red);
            color: var(--bg-dark);
            font-weight: 900;
            box-shadow: 0 0 20px var(--primary-red);
        }
        
        /* === MAIN LAYOUT === */
        .app-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            width: 100%;
        }
        
        @media (min-width: 992px) {
            .app-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        /* === PANELS === */
        .panel {
            background: var(--panel-bg);
            border: 1px solid var(--neon-green);
            border-radius: 4px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 0 10px rgba(51, 255, 87, 0.1);
            position: relative;
        }
        
        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--neon-green), transparent);
            animation: scanline 3s linear infinite;
        }
        
        @keyframes scanline {
            0% { transform: translateY(-10px); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(calc(100% + 10px)); opacity: 0; }
        }
        
        .panel-title {
            color: var(--neon-green);
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* === FORM ELEMENTS === */
        .form-group {
            margin-bottom: 1.2rem;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--electric-yellow);
            font-weight: 400;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }
        
        input, select {
            width: 100%;
            padding: 0.8rem;
            background-color: rgba(51, 255, 87, 0.05);
            border: 1px solid rgba(51, 255, 87, 0.3);
            border-radius: 3px;
            color: var(--text-primary);
            font-family: 'Roboto Mono', monospace;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--neon-green);
            box-shadow: 0 0 10px var(--neon-green);
            background-color: rgba(51, 255, 87, 0.1);
        }
        
        /* Range slider */
        input[type="range"] {
            -webkit-appearance: none;
            height: 5px;
            background: rgba(51, 255, 87, 0.2);
            border-radius: 5px;
            padding: 0;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: var(--neon-green);
            cursor: pointer;
            box-shadow: 0 0 5px var(--neon-green);
        }
        
        /* Checkbox styles for investment options */
        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.8rem;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            position: relative;
            padding: 0.5rem;
            border-radius: 3px;
            transition: all 0.3s ease;
        }
        
        .checkbox-item:hover {
            background: rgba(51, 255, 87, 0.1);
            box-shadow: 0 0 5px var(--neon-green);
        }
        
        .checkbox-item input {
            width: auto;
            cursor: pointer;
            accent-color: var(--neon-green);
        }
        
        .returns-info {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-left: 1.5rem;
            margin-bottom: 0.5rem;
            display: none;
            position: absolute;
            left: 0;
            top: 100%;
            background: var(--panel-bg);
            padding: 0.8rem;
            border: 1px solid var(--neon-green);
            border-radius: 4px;
            z-index: 10;
            width: 300px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        
        .market-details {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: rgba(51, 255, 87, 0.1);
            border-radius: 4px;
            border-left: 2px solid var(--neon-green);
        }
        
        .market-details .last-updated {
            font-style: italic;
            margin-top: 0.3rem;
            color: var(--electric-yellow);
        }
        
        .inflation-note {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            font-style: italic;
        }
        
        /* === RESULTS SECTION === */
        .result-highlight {
            font-size: 1.8rem;
            color: var(--neon-green);
            margin: 1rem 0;
            font-weight: 700;
            text-shadow: 0 0 5px var(--neon-green);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .metric {
            margin-bottom: 1.5rem;
        }
        
        .metric-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            letter-spacing: 1px;
        }
        
        .metric-value {
            font-size: 1.4rem;
            color: var(--neon-green);
            font-weight: 700;
            text-shadow: 0 0 5px var(--neon-green);
        }
        
        /* Progress bar */
        .progress-container {
            width: 100%;
            height: 20px;
            background-color: rgba(51, 255, 87, 0.1);
            border-radius: 10px;
            margin: 1rem 0;
            overflow: hidden;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--neon-green);
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.3), 
                transparent);
            animation: progressGlow 2s infinite;
        }
        
        @keyframes progressGlow {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* === CHARTS CONTAINER === */
        .chart-container {
            width: 100%;
            height: 300px;
            margin: 1rem 0;
            position: relative;
        }
        
        .chart-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        @media (min-width: 768px) {
            .chart-row {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        /* === ACTION BUTTONS === */
        .btn {
            background-color: rgba(51, 255, 87, 0.2);
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .btn:hover {
            background-color: rgba(51, 255, 87, 0.4);
            box-shadow: 0 0 15px var(--neon-green);
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -60%;
            width: 20px;
            height: 200%;
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(30deg);
            transition: all 0.3s;
        }
        
        .btn:hover::after {
            left: 120%;
        }
        
        .btn-secondary {
            background-color: rgba(140, 51, 255, 0.2);
            color: var(--cyber-magenta);
            border: 1px solid var(--cyber-magenta);
        }
        
        .btn-secondary:hover {
            background-color: rgba(140, 51, 255, 0.4);
            box-shadow: 0 0 15px var(--cyber-magenta);
        }
        
        /* === INSIGHTS SECTION === */
        .insight {
            background: rgba(51, 255, 87, 0.1);
            border-left: 3px solid var(--neon-green);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 4px 4px 0;
            position: relative;
            overflow: hidden;
        }
        
        .insight::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(51, 255, 87, 0.05), 
                transparent);
            pointer-events: none;
        }
        
        .insight-title {
            color: var(--neon-green);
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* === LOADING SCREEN === */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        
        .loading-spinner {
            border: 5px solid rgba(51, 255, 87, 0.3);
            border-radius: 50%;
            border-top: 5px solid var(--neon-green);
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
            box-shadow: 0 0 20px var(--neon-green);
        }
        
        .loading-text {
            color: var(--neon-green);
            font-size: 1.2rem;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
            animation: pulse 2s infinite;
        }
        
        /* === INVESTMENT DETAILS === */
        .investment-details {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(51, 255, 87, 0.1);
            border-radius: 4px;
            border-left: 3px solid var(--neon-green);
        }
        
        .investment-item {
            margin-bottom: 0.8rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px dashed rgba(51, 255, 87, 0.3);
        }
        
        .investment-item:last-child {
            border-bottom: none;
        }
        
        .investment-recommendation {
            font-style: italic;
            color: var(--neon-green);
            margin-top: 0.5rem;
            padding-left: 1rem;
            border-left: 2px solid var(--neon-green);
        }
        
        /* === ANIMATIONS === */
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .blink {
            animation: blink 2s infinite;
        }
        
        /* === STRATEGY SUMMARY === */
        .strategy-summary {
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(51, 255, 87, 0.1);
            border-radius: 4px;
            border: 1px solid var(--neon-green);
        }
        
        .strategy-title {
            color: var(--neon-green);
            font-size: 1.5rem;
            margin-bottom: 1rem;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 5px var(--neon-green);
        }
        
        .strategy-item {
            margin-bottom: 0.8rem;
            padding-left: 1rem;
            border-left: 2px solid var(--neon-green);
        }
        
        /* === TABS === */
        .tab-container {
            display: flex;
            border-bottom: 1px solid var(--neon-green);
            margin-bottom: 1rem;
        }
        
        .tab {
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .tab:hover {
            color: var(--neon-green);
        }
        
        .tab.active {
            color: var(--neon-green);
            border-bottom: 3px solid var(--neon-green);
            text-shadow: 0 0 5px var(--neon-green);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* === LEGAL DOC GENERATOR === */
        .legal-form-group {
            margin-bottom: 1.5rem;
        }
        
        .legal-preview {
            background: rgba(51, 255, 87, 0.05);
            border: 1px dashed var(--neon-green);
            padding: 1.5rem;
            margin-top: 1rem;
            border-radius: 4px;
            font-family: 'Roboto Mono', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        
        /* === FREEDOM RANK === */
        .freedom-rank {
            font-size: 3rem;
            color: var(--neon-green);
            text-align: center;
            margin: 1rem 0;
            text-shadow: 0 0 10px var(--neon-green);
            animation: pulse 2s infinite;
        }
        
        .rank-label {
            text-align: center;
            color: var(--electric-yellow);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        /* === TOGGLE SWITCH === */
        .switch-container {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-right: 10px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(51, 255, 87, 0.2);
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: var(--bg-dark);
            transition: .4s;
            border-radius: 50%;
            border: 1px solid var(--neon-green);
        }
        
        input:checked + .slider {
            background-color: var(--neon-green);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* === MONTE CARLO SIMULATION === */
        .simulation-options {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .simulation-btn {
            background: rgba(51, 255, 87, 0.1);
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .simulation-btn.active {
            background: var(--neon-green);
            color: var(--bg-dark);
            font-weight: bold;
        }
        
        /* === RESPONSIVE ADJUSTMENTS === */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
            }
            
            .module-selector {
                flex-direction: column;
                align-items: stretch;
            }
            
            .module-btn {
                width: 100%;
            }
        }
		option[value="basic"],
option[value="moderate"],
option[value="luxurious"],
option[value="low"],
option[value="high"] {
  background-color: #000000 !important;
  color: #ff0000 !important;
}
    </style>
</head>
<body>
    <!-- Loading screen -->
    <div class="loading-screen" id="loading-screen">
        <div class="loading-spinner"></div>
        <div class="loading-text">CALCULATING YOUR FREEDOM PLAN...</div>
    </div>

    <!-- Matrix background animation -->
    <canvas id="matrix-bg"></canvas>
    
    <div class="container">
        <header>
            <h1>FREEDOM GLITCH</h1>
            <div class="subtitle">INDIAN RETIREMENT & INVESTMENT PLANNER</div>
        </header>
        
        <div class="app-grid">
            <!-- Input Section -->
            <div>
                <!-- Personal Information -->
                <div class="panel">
                    <div class="panel-title">PERSONAL INFORMATION</div>
                    
                    <div class="form-group">
                        <label for="current-age">CURRENT AGE</label>
                        <input type="number" id="current-age" min="18" max="100" value="30">
                    </div>
                    
                    <div class="form-group">
                        <label for="retirement-age">PLANNED RETIREMENT AGE</label>
                        <input type="number" id="retirement-age" min="40" max="80" value="60">
                    </div>
                    
                    <div class="form-group">
                        <label for="life-expectancy">LIFE EXPECTANCY</label>
                        <input type="number" id="life-expectancy" min="60" max="100" value="85">
                    </div>
                    
                    <div class="form-group">
                        <label for="annual-income">ANNUAL INCOME (₹)</label>
                        <input type="number" id="annual-income" min="100000" step="50000" value="1000000">
                    </div>
                    
                    <div class="form-group">
                        <label for="current-savings">CURRENT SAVINGS (₹)</label>
                        <input type="number" id="current-savings" min="0" step="10000" value="500000">
                    </div>
                    
                    <div class="form-group">
                        <label for="monthly-expenses">MONTHLY EXPENSES (₹)</label>
                        <input type="number" id="monthly-expenses" min="5000" step="1000" value="50000">
                    </div>
                    
                    <div class="form-group">
                        <label for="lifestyle">DESIRED RETIREMENT LIFESTYLE</label>
                        <select id="lifestyle">
                            <option value="basic">Basic (₹40,000/month)</option>
                            <option value="moderate" selected>Moderate (₹75,000/month)</option>
                            <option value="luxurious">Luxurious (₹1,50,000+/month)</option>
                        </select>
                    </div>
                </div>
                
                <!-- Investment Preferences -->
                <div class="panel">
                    <div class="panel-title">INVESTMENT PREFERENCES</div>
                    
                    <div class="form-group">
                        <label for="inflation-rate">INFLATION RATE (%)</label>
                        <input type="number" id="inflation-rate" min="0" max="20" step="0.1" value="5.7">
                        <div class="inflation-note">Current Indian inflation rate: 5.7% (Last updated: June 2024, Source: RBI)</div>
                    </div>
                    
                    <div class="form-group">
                        <label>PREFERRED INVESTMENT OPTIONS</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item" data-option="mf">
                                <input type="checkbox" id="mf" checked>
                                <label for="mf">Mutual Funds (SIPs)</label>
                                <div class="returns-info" id="mf-returns">
                                    <strong>5-year annualized returns:</strong> 12-15% (Equity), 8-10% (Debt)
                                    <div class="market-details">
                                        <strong>Current Market Rates:</strong><br>
                                        - Large Cap Funds: 12-14%<br>
                                        - Mid Cap Funds: 15-18%<br>
                                        - Small Cap Funds: 18-22%<br>
                                        - Debt Funds: 7-9%<br>
                                        <div class="last-updated">Last updated: June 2024 (Source: AMFI)</div>
                                    </div>
                                </div>
                            </div>
                            <div class="checkbox-item" data-option="bonds">
                                <input type="checkbox" id="bonds">
                                <label for="bonds">Bonds</label>
                                <div class="returns-info" id="bonds-returns">
                                    <strong>5-year annualized returns:</strong> 7-9% (Govt Bonds), 8-10% (Corporate Bonds)
                                    <div class="market-details">
                                        <strong>Current Market Rates:</strong><br>
                                        - 10-year G-Sec: 7.1%<br>
                                        - AAA Corporate Bonds: 8.2%<br>
                                        - SDL Bonds: 7.5-7.8%<br>
                                        <div class="last-updated">Last updated: June 2024 (Source: RBI)</div>
                                    </div>
                                </div>
                            </div>
                            <div class="checkbox-item" data-option="gold">
                                <input type="checkbox" id="gold" checked>
                                <label for="gold">Gold/Silver</label>
                                <div class="returns-info" id="gold-returns">
                                    <strong>5-year annualized returns:</strong> 9-11% (Gold), 12-15% (Silver)
                                    <div class="market-details">
                                        <strong>Current Market Rates:</strong><br>
                                        - Gold (24K): ₹6,200/gm<br>
                                        - Silver: ₹78,000/kg<br>
                                        - Gold ETFs: Tracking physical gold<br>
                                        <div class="last-updated">Last updated: June 2024 (Source: MCX)</div>
                                    </div>
                                </div>
                            </div>
                            <div class="checkbox-item" data-option="stocks">
                                <input type="checkbox" id="stocks">
                                <label for="stocks">Stocks</label>
                                <div class="returns-info" id="stocks-returns">
                                    <strong>5-year annualized returns:</strong> 15-18% (Large Cap), 18-25% (Mid/Small Cap)
                                    <div class="market-details">
                                        <strong>Current Market Status:</strong><br>
                                        - Nifty 50 P/E: 22.5<br>
                                        - Nifty 500 P/E: 23.1<br>
                                        - Market Cap to GDP: 110%<br>
                                        <div class="last-updated">Last updated: June 2024 (Source: NSE)</div>
                                    </div>
                                </div>
                            </div>
                            <div class="checkbox-item" data-option="real-estate">
                                <input type="checkbox" id="real-estate">
                                <label for="real-estate">Real Estate</label>
                                <div class="returns-info" id="real-estate-returns">
                                    <strong>5-year annualized returns:</strong> 6-8% (Residential), 10-12% (Commercial)
                                    <div class="market-details">
                                        <strong>Current Market Rates:</strong><br>
                                        - Residential: 6-8% yield<br>
                                        - Commercial: 8-10% yield<br>
                                        - REITs: 7-9% distribution yield<br>
                                        <div class="last-updated">Last updated: June 2024 (Source: PropTiger)</div>
                                    </div>
                                </div>
                            </div>
                            <div class="checkbox-item" data-option="ppf">
                                <input type="checkbox" id="ppf">
                                <label for="ppf">PPF/EPF</label>
                                <div class="returns-info" id="ppf-returns">
                                    <strong>5-year annualized returns:</strong> 7-8% (Fixed by Govt)
                                    <div class="market-details">
                                        <strong>Current Rates:</strong><br>
                                        - PPF: 7.1%<br>
                                        - EPF: 8.1%<br>
                                        - SCSS: 8.2%<br>
                                        <div class="last-updated">Last updated: June 2024 (Source: Govt. Notification)</div>
                                    </div>
                                </div>
                            </div>
                            <div class="checkbox-item" data-option="reits">
                                <input type="checkbox" id="reits">
                                <label for="reits">REITs/InvITs</label>
                                <div class="returns-info" id="reits-returns">
                                    <strong>5-year annualized returns:</strong> 10-12% (Dividend + Capital Appreciation)
                                    <div class="market-details">
                                        <strong>Current Market Rates:</strong><br>
                                        - Listed REITs: 6-8% yield<br>
                                        - InvITs: 8-10% yield<br>
                                        - Total returns: 10-12%<br>
                                        <div class="last-updated">Last updated: June 2024 (Source: NSE)</div>
                                    </div>
                                </div>
                            </div>
                            <div class="checkbox-item" data-option="crypto">
                                <input type="checkbox" id="crypto">
                                <label for="crypto">Crypto</label>
                                <div class="returns-info" id="crypto-returns">
                                    <strong>5-year annualized returns:</strong> Highly volatile (50-100% but with high risk)
                                    <div class="market-details">
                                        <strong>Current Market Status:</strong><br>
                                        - Bitcoin: ₹45,00,000<br>
                                        - Ethereum: ₹2,50,000<br>
                                        - Market Cap: $2.5T<br>
                                        <div class="last-updated">Last updated: June 2024 (Source: CoinMarketCap)</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="risk-appetite">RISK APPETITE</label>
                        <select id="risk-appetite">
                            <option value="low">Low (Conservative)</option>
                            <option value="moderate" selected>Moderate (Balanced)</option>
                            <option value="high">High (Aggressive)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="expected-return">EXPECTED ANNUAL RETURN (%)</label>
                        <input type="number" id="expected-return" min="1" max="30" step="0.5" value="12">
                    </div>
                </div>
                
                <!-- Emergency Fund -->
                <div class="panel">
                    <div class="panel-title">EMERGENCY FUND PLANNING</div>
                    
                    <div class="form-group">
                        <label for="emergency-months">NUMBER OF MONTHS TO COVER</label>
                        <input type="number" id="emergency-months" min="3" max="24" value="6">
                    </div>
                    
                    <div class="form-group">
                        <label for="current-emergency">CURRENT EMERGENCY FUND (₹)</label>
                        <input type="number" id="current-emergency" min="0" step="10000" value="100000">
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="panel">
                    <button id="calculate-btn" class="btn">CALCULATE PLAN</button>
                    <button id="reset-btn" class="btn">RESET</button>
                </div>
            </div>
  
            <!-- Results Section -->
            <div id="results-section" style="display: none;">
                <!-- Retirement Corpus -->
                <div class="panel">
                    <div class="panel-title">RETIREMENT CORPUS NEEDED</div>
                    <div class="result-highlight" id="corpus-needed">₹3,50,00,000</div>
                    <div>To sustain your desired lifestyle from age <span id="retirement-age-display">60</span> to <span id="life-expectancy-display">85</span></div>
                    
                    <div class="metric">
                        <div class="metric-label">CURRENT SAVINGS</div>
                        <div class="metric-value" id="current-savings-display">₹5,00,000</div>
                    </div>
                    
                    <div class="metric">
                        <div class="metric-label">GAP TO BE FILLED</div>
                        <div class="metric-value" id="corpus-gap">₹3,45,00,000</div>
                    </div>
                </div>
                
                <!-- Monthly Investment -->
                <div class="panel">
                    <div class="panel-title">MONTHLY INVESTMENT REQUIRED</div>
                    <div class="result-highlight" id="monthly-investment">₹25,000</div>
                    <div>To achieve your retirement corpus at <span id="expected-return-display">12</span>% annual return</div>
                    
                    <div class="chart-container">
                        <canvas id="savings-chart"></canvas>
                    </div>
                </div>
                
                <!-- Investment Allocation -->
                <div class="panel">
                    <div class="panel-title">RECOMMENDED INVESTMENT ALLOCATION</div>
                    
                    <div class="chart-row">
                        <div class="chart-container">
                            <canvas id="allocation-chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <canvas id="projection-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="investment-details" id="allocation-details">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Actionable Insights -->
                <div class="panel">
                    <div class="panel-title">ACTIONABLE INSIGHTS</div>
                    
                    <div class="insight">
                        <div class="insight-title">RETIREMENT SAVINGS</div>
                        <div id="insight-retirement">To achieve your retirement goals, consider increasing your monthly investment by ₹5,000.</div>
                    </div>
                    
                    <div class="insight">
                        <div class="insight-title">EMERGENCY FUND</div>
                        <div id="insight-emergency">Your current emergency fund covers 2 months; aim for at least 6 months of expenses.</div>
                    </div>
                    
                    <div class="insight">
                        <div class="insight-title">INVESTMENT STRATEGY</div>
                        <div id="insight-investment">Based on your risk appetite, a higher allocation to equity mutual funds may yield better returns.</div>
                    </div>
                </div>
                
                <!-- Investment Strategy Summary -->
                <div class="panel strategy-summary">
                    <div class="strategy-title">YOUR INVESTMENT STRATEGY SUMMARY</div>
                    <div id="strategy-summary-content">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
      // === GLOBAL VARIABLES ===
let userData = {};

// Indian market specific data
const lifestyleCosts = {
    basic: 40000,
    moderate: 75000,
    luxurious: 150000
};

// Investment options with detailed sub-categories and returns
const investmentOptionsData = {
    'Mutual Funds': {
        subtypes: [
            { name: 'Large Cap Equity Funds', returns: '12-14%', risk: 'Medium' },
            { name: 'Mid Cap Equity Funds', returns: '15-18%', risk: 'High' },
            { name: 'Small Cap Equity Funds', returns: '18-22%', risk: 'Very High' },
            { name: 'Multi Cap Funds', returns: '13-16%', risk: 'Medium-High' },
            { name: 'ELSS (Tax Saving)', returns: '12-15%', risk: 'Medium' },
            { name: 'Sectoral/Thematic Funds', returns: '14-20%', risk: 'High' },
            { name: 'Index Funds', returns: '11-13%', risk: 'Medium' },
            { name: 'Debt Funds', returns: '7-9%', risk: 'Low' },
            { name: 'Hybrid Funds', returns: '10-12%', risk: 'Medium' }
        ],
        color: '#FF5733', // Orange
        lastUpdated: 'June 2024',
        source: 'AMFI',
        minAllocation: 10,
        maxAllocation: 70
    },
    'Bonds': {
        subtypes: [
            { name: 'Government Bonds (G-Secs)', returns: '7-8%', risk: 'Low' },
            { name: 'Corporate Bonds (AAA)', returns: '8-9%', risk: 'Medium-Low' },
            { name: 'Corporate Bonds (AA)', returns: '9-10%', risk: 'Medium' },
            { name: 'Tax-Free Bonds', returns: '6-7%', risk: 'Low' },
            { name: 'Sovereign Gold Bonds', returns: '2.5% + Gold Appreciation', risk: 'Medium' }
        ],
        color: '#33FF57', // Green
        lastUpdated: 'June 2024',
        source: 'RBI',
        minAllocation: 5,
        maxAllocation: 40
    },
    'Gold/Silver': {
        subtypes: [
            { name: 'Physical Gold', returns: '9-11%', risk: 'Medium' },
            { name: 'Gold ETFs', returns: '9-11%', risk: 'Medium' },
            { name: 'Gold Mutual Funds', returns: '9-11%', risk: 'Medium' },
            { name: 'Sovereign Gold Bonds', returns: '2.5% + Gold Appreciation', risk: 'Medium' },
            { name: 'Silver ETFs', returns: '12-15%', risk: 'Medium-High' }
        ],
        color: '#F3FF33', // Yellow
        lastUpdated: 'June 2024',
        source: 'MCX',
        minAllocation: 5,
        maxAllocation: 20
    },
    'Stocks': {
        subtypes: [
            { name: 'Large Cap Stocks', returns: '12-15%', risk: 'Medium' },
            { name: 'Mid Cap Stocks', returns: '18-22%', risk: 'High' },
            { name: 'Small Cap Stocks', returns: '20-25%', risk: 'Very High' },
            { name: 'Dividend Stocks', returns: '10-12% + Dividends', risk: 'Medium' },
            { name: 'Blue Chip Stocks', returns: '12-14%', risk: 'Medium' }
        ],
        color: '#3357FF', // Blue
        lastUpdated: 'June 2024',
        source: 'NSE',
        minAllocation: 5,
        maxAllocation: 60
    },
    'Real Estate': {
        subtypes: [
            { name: 'Residential Property', returns: '6-8%', risk: 'Medium' },
            { name: 'Commercial Property', returns: '10-12%', risk: 'Medium-High' },
            { name: 'Plots/Land', returns: '8-10%', risk: 'High' },
            { name: 'Real Estate Crowdfunding', returns: '12-15%', risk: 'High' }
        ],
        color: '#FF33F3', // Pink
        lastUpdated: 'June 2024',
        source: 'PropTiger',
        minAllocation: 5,
        maxAllocation: 30
    },
    'PPF/EPF': {
        subtypes: [
            { name: 'Public Provident Fund (PPF)', returns: '7.1%', risk: 'Very Low' },
            { name: 'Employee Provident Fund (EPF)', returns: '8.1%', risk: 'Very Low' },
            { name: 'Senior Citizen Savings Scheme', returns: '8.2%', risk: 'Very Low' },
            { name: 'NPS (Tier I)', returns: '9-12%', risk: 'Medium' }
        ],
        color: '#33FFF3', // Cyan
        lastUpdated: 'June 2024',
        source: 'Govt. Notification',
        minAllocation: 5,
        maxAllocation: 30
    },
    'REITs/InvITs': {
        subtypes: [
            { name: 'Commercial REITs', returns: '10-12%', risk: 'Medium' },
            { name: 'Retail REITs', returns: '9-11%', risk: 'Medium' },
            { name: 'Infrastructure InvITs', returns: '11-13%', risk: 'Medium' }
        ],
        color: '#FF8C33', // Orange
        lastUpdated: 'June 2024',
        source: 'NSE',
        minAllocation: 5,
        maxAllocation: 20
    },
    'Crypto': {
        subtypes: [
            { name: 'Bitcoin', returns: 'Highly volatile', risk: 'Very High' },
            { name: 'Ethereum', returns: 'Highly volatile', risk: 'Very High' },
            { name: 'Stablecoins', returns: '5-8% (Staking)', risk: 'Medium' }
        ],
        color: '#8C33FF', // Purple
        lastUpdated: 'June 2024',
        source: 'CoinMarketCap',
        minAllocation: 0,
        maxAllocation: 10
    }
};

// === DOM ELEMENTS === 
let currentAgeInput, retirementAgeInput, lifeExpectancyInput, annualIncomeInput, 
    currentSavingsInput, monthlyExpensesInput, lifestyleInput, riskAppetiteInput, 
    expectedReturnInput, emergencyMonthsInput, currentEmergencyInput, inflationRateInput;

let corpusNeededEl, retirementAgeDisplay, lifeExpectancyDisplay, currentSavingsDisplay, 
    corpusGapEl, monthlyInvestmentEl, expectedReturnDisplay;

let insightRetirement, insightEmergency, insightInvestment;

let calculateBtn, resetBtn;

let loadingScreen, resultsSection, allocationDetails, returnsInfoElements, strategySummaryContent;

let savingsChart, allocationChart, projectionChart;

// === INITIALIZATION ===
document.addEventListener('DOMContentLoaded', function() {
    initializeDOMElements();
    setupEventListeners();
    initMatrixBackground();
    initCharts();
});

function initializeDOMElements() {
    // Input elements
    currentAgeInput = document.getElementById('current-age');
    retirementAgeInput = document.getElementById('retirement-age');
    lifeExpectancyInput = document.getElementById('life-expectancy');
    annualIncomeInput = document.getElementById('annual-income');
    currentSavingsInput = document.getElementById('current-savings');
    monthlyExpensesInput = document.getElementById('monthly-expenses');
    lifestyleInput = document.getElementById('lifestyle');
    riskAppetiteInput = document.getElementById('risk-appetite');
    expectedReturnInput = document.getElementById('expected-return');
    emergencyMonthsInput = document.getElementById('emergency-months');
    currentEmergencyInput = document.getElementById('current-emergency');
    inflationRateInput = document.getElementById('inflation-rate');
    
    // Result elements
    corpusNeededEl = document.getElementById('corpus-needed');
    retirementAgeDisplay = document.getElementById('retirement-age-display');
    lifeExpectancyDisplay = document.getElementById('life-expectancy-display');
    currentSavingsDisplay = document.getElementById('current-savings-display');
    corpusGapEl = document.getElementById('corpus-gap');
    monthlyInvestmentEl = document.getElementById('monthly-investment');
    expectedReturnDisplay = document.getElementById('expected-return-display');
    
    // Insight elements
    insightRetirement = document.getElementById('insight-retirement');
    insightEmergency = document.getElementById('insight-emergency');
    insightInvestment = document.getElementById('insight-investment');
    
    // Buttons
    calculateBtn = document.getElementById('calculate-btn');
    resetBtn = document.getElementById('reset-btn');
    
    // Other elements
    loadingScreen = document.getElementById('loading-screen');
    resultsSection = document.getElementById('results-section');
    allocationDetails = document.getElementById('allocation-details');
    returnsInfoElements = document.querySelectorAll('.returns-info');
    strategySummaryContent = document.getElementById('strategy-summary-content');
}

function setupEventListeners() {
    calculateBtn.addEventListener('click', function() {
        showLoadingScreen();
        setTimeout(function() {
            try {
                calculatePlan();
                hideLoadingScreen();
            } catch (error) {
                console.error("Calculation error:", error);
                hideLoadingScreen();
                alert("An error occurred during calculation. Please try again.");
            }
        }, 200);
    });
    
    resetBtn.addEventListener('click', resetData);
    
    const recalcInputs = [
        currentAgeInput, retirementAgeInput, lifeExpectancyInput,
        annualIncomeInput, currentSavingsInput, monthlyExpensesInput,
        lifestyleInput, riskAppetiteInput, expectedReturnInput,
        emergencyMonthsInput, currentEmergencyInput, inflationRateInput
    ];
    
    recalcInputs.forEach(input => {
        input.addEventListener('change', function() {
            if (resultsSection.style.display === 'block') {
                showLoadingScreen();
                setTimeout(function() {
                    try {
                        calculatePlan();
                        hideLoadingScreen();
                    } catch (error) {
                        console.error("Recalculation error:", error);
                        hideLoadingScreen();
                    }
                }, 200);
            }
        });
    });
    
    document.querySelectorAll('.checkbox-item').forEach(item => {
        item.addEventListener('mouseenter', function() {
            const option = this.getAttribute('data-option');
            const returnsInfo = document.getElementById(`${option}-returns`);
            if (returnsInfo) {
                returnsInfo.style.display = 'block';
            }
        });
        
        item.addEventListener('mouseleave', function() {
            const option = this.getAttribute('data-option');
            const returnsInfo = document.getElementById(`${option}-returns`);
            if (returnsInfo) {
                returnsInfo.style.display = 'none';
            }
        });
    });
}

function showLoadingScreen() {
    if (loadingScreen) {
        loadingScreen.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
}

function hideLoadingScreen() {
    if (loadingScreen && resultsSection) {
        loadingScreen.style.display = 'none';
        document.body.style.overflow = 'auto';
        resultsSection.style.display = 'block';
        
        if (savingsChart && allocationChart && projectionChart) {
            setTimeout(() => {
                savingsChart.update();
                allocationChart.update();
                projectionChart.update();
            }, 100);
        }
    }
}

function initMatrixBackground() {
    const canvas = document.getElementById('matrix-bg');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    
    const matrixChars = "01010101010101010101010101010101010";
    const fontSize = 14;
    const columns = canvas.width / fontSize;
    
    const drops = [];
    for (let i = 0; i < columns; i++) {
        drops[i] = Math.random() * canvas.height;
    }
    
    function draw() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.fillStyle = '#cc0000';
        ctx.font = `${fontSize}px 'Roboto Mono', monospace`;
        
        for (let i = 0; i < drops.length; i++) {
            const text = matrixChars.charAt(Math.floor(Math.random() * matrixChars.length));
            ctx.fillText(text, i * fontSize, drops[i] * fontSize);
            
            if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                drops[i] = 0;
            }
            
            drops[i]++;
        }
    }
    
    window.addEventListener('resize', function() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });
    
    setInterval(draw, 50);
}

function initCharts() {
    const savingsChartCtx = document.getElementById('savings-chart').getContext('2d');
    const allocationChartCtx = document.getElementById('allocation-chart').getContext('2d');
    const projectionChartCtx = document.getElementById('projection-chart').getContext('2d');

    savingsChart = new Chart(savingsChartCtx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Projected Savings Growth',
                data: [],
                borderColor: '#cc0000',
                backgroundColor: 'rgba(204, 0, 0, 0.1)',
                borderWidth: 2,
                tension: 0.1,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(204, 0, 0, 0.1)' },
                    ticks: {
                        callback: function(value) {
                            return '₹' + (value / 100000).toFixed(1) + 'L';
                        }
                    }
                },
                x: { grid: { color: 'rgba(204, 0, 0, 0.1)' } }
            },
            plugins: {
                legend: { labels: { color: '#cc0000' } },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return '₹' + context.parsed.y.toLocaleString('en-IN');
                        }
                    }
                }
            }
        }
    });
    
    allocationChart = new Chart(allocationChartCtx, {
        type: 'pie',
        data: {
            labels: [],
            datasets: [{
                data: [],
                backgroundColor: [
                    '#FF5733', '#33FF57', '#F3FF33', '#3357FF', 
                    '#FF33F3', '#33FFF3', '#FF8C33', '#8C33FF'
                ],
                borderColor: 'rgba(0, 0, 0, 0.1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right',
                    labels: {
                        color: '#FFFF00',
                        font: { family: "'Roboto Mono', monospace" }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.label}: ${context.raw}%`;
                        }
                    }
                }
            }
        }
    });
    
    projectionChart = new Chart(projectionChartCtx, {
        type: 'line',
        data: { labels: [], datasets: [] },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(204, 0, 0, 0.1)' },
                    ticks: {
                        callback: function(value) {
                            return '₹' + (value / 100000).toFixed(1) + 'L';
                        }
                    }
                },
                x: { grid: { color: 'rgba(204, 0, 0, 0.1)' } }
            },
            plugins: {
                legend: {
                    labels: {
                        color: '#cc0000',
                        font: { family: "'Roboto Mono', monospace" }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.dataset.label + ': ₹' + context.parsed.y.toLocaleString('en-IN');
                        }
                    }
                }
            }
        }
    });
}

function calculatePlan() {
    userData = {
        currentAge: parseInt(currentAgeInput.value) || 30,
        retirementAge: parseInt(retirementAgeInput.value) || 60,
        lifeExpectancy: parseInt(lifeExpectancyInput.value) || 85,
        annualIncome: parseInt(annualIncomeInput.value) || 1000000,
        currentSavings: parseInt(currentSavingsInput.value) || 500000,
        monthlyExpenses: parseInt(monthlyExpensesInput.value) || 50000,
        lifestyle: lifestyleInput.value,
        riskAppetite: riskAppetiteInput.value,
        expectedReturn: parseFloat(expectedReturnInput.value) || 12,
        emergencyMonths: parseInt(emergencyMonthsInput.value) || 6,
        currentEmergency: parseInt(currentEmergencyInput.value) || 100000,
        inflationRate: parseFloat(inflationRateInput.value) || 5.7,
        investmentOptions: getSelectedInvestmentOptions()
    };
    
    calculateRetirementCorpus();
    calculateMonthlyInvestment();
    calculateEmergencyFund();
    updateInvestmentAllocation();
    generateInsights();
    updateResultsUI();
}

function getSelectedInvestmentOptions() {
    const selectedOptions = [];
    document.querySelectorAll('.checkbox-item input:checked').forEach(checkbox => {
        const option = checkbox.id;
        switch(option) {
            case 'mf': selectedOptions.push('Mutual Funds'); break;
            case 'bonds': selectedOptions.push('Bonds'); break;
            case 'gold': selectedOptions.push('Gold/Silver'); break;
            case 'stocks': selectedOptions.push('Stocks'); break;
            case 'real-estate': selectedOptions.push('Real Estate'); break;
            case 'ppf': selectedOptions.push('PPF/EPF'); break;
            case 'reits': selectedOptions.push('REITs/InvITs'); break;
            case 'crypto': selectedOptions.push('Crypto'); break;
        }
    });
    return selectedOptions.length ? selectedOptions : ['Mutual Funds'];
}

function calculateRetirementCorpus() {
    userData.yearsToRetirement = userData.retirementAge - userData.currentAge;
    userData.retirementDuration = userData.lifeExpectancy - userData.retirementAge;
    userData.desiredMonthlyExpenses = lifestyleCosts[userData.lifestyle];
    
    userData.futureMonthlyExpenses = userData.desiredMonthlyExpenses * 
        Math.pow(1 + (userData.inflationRate / 100), userData.yearsToRetirement);
    
    const realReturn = ((1 + (userData.expectedReturn / 100)) / 
        (1 + (userData.inflationRate / 100))) - 1;
    
    const monthlyRealReturn = Math.pow(1 + realReturn, 1/12) - 1;
    const monthsInRetirement = userData.retirementDuration * 12;
    
    userData.corpusNeeded = userData.futureMonthlyExpenses * 
        ((1 - Math.pow(1 + monthlyRealReturn, -monthsInRetirement)) / monthlyRealReturn);
    
    userData.corpusGap = Math.max(0, userData.corpusNeeded - userData.currentSavings);
}

function calculateMonthlyInvestment() {
    const futureValueOfCurrentSavings = userData.currentSavings * 
        Math.pow(1 + (userData.expectedReturn / 100), userData.yearsToRetirement);
    
    const remainingCorpus = Math.max(0, userData.corpusNeeded - futureValueOfCurrentSavings);
    const monthlyRate = (userData.expectedReturn / 100) / 12;
    const numberOfPayments = userData.yearsToRetirement * 12;
    
    userData.monthlyInvestment = remainingCorpus * 
        (monthlyRate / (Math.pow(1 + monthlyRate, numberOfPayments) - 1));
    
    generateSavingsProjection();
}

function generateSavingsProjection() {
    const projection = [];
    const labels = [];
    let currentValue = userData.currentSavings;
    const monthlyReturn = (userData.expectedReturn / 100) / 12;
    
    for (let year = 0; year <= userData.yearsToRetirement; year++) {
        labels.push(userData.currentAge + year);
        
        if (year === 0) {
            projection.push(currentValue);
            continue;
        }
        
        for (let month = 1; month <= 12; month++) {
            currentValue *= (1 + monthlyReturn);
            currentValue += userData.monthlyInvestment;
        }
        
        projection.push(currentValue);
    }
    
    userData.savingsProjection = { labels, values: projection };
}

function calculateEmergencyFund() {
    userData.targetEmergencyFund = userData.monthlyExpenses * userData.emergencyMonths;
    userData.emergencyFundGap = Math.max(0, userData.targetEmergencyFund - userData.currentEmergency);
    userData.emergencyFundCoverage = Math.min(100, 
        (userData.currentEmergency / userData.targetEmergencyFund) * 100);
}

function updateInvestmentAllocation() {
    const selectedOptions = userData.investmentOptions;
    const riskWeights = {
        'low': {
            'Mutual Funds': 0.4, 'Bonds': 0.3, 'Gold/Silver': 0.1, 
            'Stocks': 0.05, 'Real Estate': 0.05, 'PPF/EPF': 0.3, 
            'REITs/InvITs': 0.05, 'Crypto': 0
        },
        'moderate': {
            'Mutual Funds': 0.5, 'Bonds': 0.2, 'Gold/Silver': 0.1, 
            'Stocks': 0.15, 'Real Estate': 0.1, 'PPF/EPF': 0.2, 
            'REITs/InvITs': 0.1, 'Crypto': 0.05
        },
        'high': {
            'Mutual Funds': 0.4, 'Bonds': 0.1, 'Gold/Silver': 0.1, 
            'Stocks': 0.25, 'Real Estate': 0.15, 'PPF/EPF': 0.1, 
            'REITs/InvITs': 0.15, 'Crypto': 0.1
        }
    };
    
    const ageFactor = Math.min(1, Math.max(0, (userData.currentAge - 25) / 40));
    const riskProfile = riskWeights[userData.riskAppetite];
    
    let totalWeight = 0;
    const initialAllocation = {};
    
    selectedOptions.forEach(option => {
        let weight = riskProfile[option] || 0.1;
        
        if (option === 'Stocks' || option === 'Mutual Funds' || option === 'Crypto') {
            weight *= (1.5 - ageFactor * 0.5);
        } else if (option === 'Bonds' || option === 'PPF/EPF') {
            weight *= (0.5 + ageFactor * 0.5);
        }
        
        initialAllocation[option] = weight;
        totalWeight += weight;
    });
    
    userData.investmentAllocation = {};
    for (const option in initialAllocation) {
        let percentage = (initialAllocation[option] / totalWeight) * 100;
        
        if (investmentOptionsData[option]) {
            percentage = Math.max(investmentOptionsData[option].minAllocation, 
                            Math.min(investmentOptionsData[option].maxAllocation, percentage));
        }
        
        userData.investmentAllocation[option] = Math.round(percentage);
    }
    
    const totalAllocation = Object.values(userData.investmentAllocation).reduce((a, b) => a + b, 0);
    if (totalAllocation !== 100) {
        const largestOption = Object.keys(userData.investmentAllocation).reduce((a, b) => 
            userData.investmentAllocation[a] > userData.investmentAllocation[b] ? a : b);
        userData.investmentAllocation[largestOption] += 100 - totalAllocation;
    }
    
    updateAllocationChart();
    generateProjectedReturns();
    generateAllocationDetails();
    generateStrategySummary();
}

function updateAllocationChart() {
    const allocationLabels = [];
    const allocationData = [];
    const backgroundColors = [];
    
    for (const option in userData.investmentAllocation) {
        allocationLabels.push(option);
        allocationData.push(userData.investmentAllocation[option]);
        backgroundColors.push(investmentOptionsData[option]?.color || '#999999');
    }
    
    allocationChart.data.labels = allocationLabels;
    allocationChart.data.datasets[0].data = allocationData;
    allocationChart.data.datasets[0].backgroundColor = backgroundColors;
    allocationChart.update();
}

function generateProjectedReturns() {
    const expectedReturns = {
        'Mutual Funds': 12, 'Bonds': 7.5, 'Gold/Silver': 10, 
        'Stocks': 18, 'Real Estate': 9, 'PPF/EPF': 7.5, 
        'REITs/InvITs': 11, 'Crypto': 30
    };
    
    const labels = [];
    for (let year = 0; year <= userData.yearsToRetirement; year++) {
        labels.push(userData.currentAge + year);
    }
    
    const datasets = [];
    const colors = ['#FF5733', '#33FF57', '#F3FF33', '#3357FF', '#FF33F3', '#33FFF3', '#FF8C33', '#8C33FF'];
    let colorIndex = 0;
    
    for (const option in userData.investmentAllocation) {
        const percentage = userData.investmentAllocation[option] / 100;
        const annualReturn = expectedReturns[option] || 10;
        const monthlyReturn = Math.pow(1 + annualReturn / 100, 1/12) - 1;
        const investmentAmount = userData.monthlyInvestment * percentage;
        let currentValue = userData.currentSavings * percentage;
        
        const data = [];
        for (let year = 0; year <= userData.yearsToRetirement; year++) {
            if (year === 0) {
                data.push(currentValue);
                continue;
            }
            
            for (let month = 1; month <= 12; month++) {
                currentValue *= (1 + monthlyReturn);
                currentValue += investmentAmount;
            }
            
            data.push(currentValue);
        }
        
        datasets.push({
            label: `${option} (${userData.investmentAllocation[option]}%)`,
            data: data,
            borderColor: colors[colorIndex % colors.length],
            backgroundColor: 'rgba(0, 0, 0, 0)',
            borderWidth: 2,
            tension: 0.1
        });
        
        colorIndex++;
    }
    
    projectionChart.data.labels = labels;
    projectionChart.data.datasets = datasets;
    projectionChart.update();
}

function generateAllocationDetails() {
    let html = '';
    
    for (const option in userData.investmentAllocation) {
        const percentage = userData.investmentAllocation[option];
        const monthlyAmount = (percentage / 100) * userData.monthlyInvestment;
        const annualAmount = monthlyAmount * 12;
        const optionData = investmentOptionsData[option];
        
        if (optionData) {
            html += `<div class="investment-item">
                <strong>${option} (${percentage}%)</strong>
                <div class="investment-recommendation">
                    "As per your lifestyle requirements and risk appetite, I recommend investing ₹${Math.round(monthlyAmount).toLocaleString('en-IN')}/month (₹${Math.round(annualAmount).toLocaleString('en-IN')}/year) in ${option}."
                </div>
                <div class="investment-subtypes">`;
            
            optionData.subtypes.forEach(subtype => {
                html += `<div>• ${subtype.name}: ${subtype.returns} (${subtype.risk} risk)</div>`;
            });
            
            html += `<div class="market-details">
                <strong>Current Market Data:</strong><br>
                Last updated: ${optionData.lastUpdated}<br>
                Source: ${optionData.source}
            </div>`;
            
            html += `</div></div>`;
        }
    }
    
    allocationDetails.innerHTML = html;
}

function generateStrategySummary() {
    let html = '';
    
    for (const option in userData.investmentAllocation) {
        const percentage = userData.investmentAllocation[option];
        const monthlyAmount = (percentage / 100) * userData.monthlyInvestment;
        const annualAmount = monthlyAmount * 12;
        
        html += `<div class="strategy-item">
            <strong>${option}:</strong> ${percentage}% allocation (₹${Math.round(monthlyAmount).toLocaleString('en-IN')}/month, ₹${Math.round(annualAmount).toLocaleString('en-IN')}/year)
        </div>`;
    }
    
    html += `<div class="strategy-item" style="margin-top: 1rem; border-top: 1px dashed var(--matrix-green); padding-top: 0.5rem;">
        <strong>TOTAL MONTHLY INVESTMENT:</strong> ₹${Math.round(userData.monthlyInvestment).toLocaleString('en-IN')}
    </div>`;
    
    strategySummaryContent.innerHTML = html;
}

function generateInsights() {
    const savingsRatio = (userData.currentSavings / userData.corpusNeeded) * 100;
    let retirementText = '';
    
    if (savingsRatio < 10) {
        retirementText = `You've only saved ${savingsRatio.toFixed(1)}% of your retirement goal. Consider increasing your monthly investment or exploring higher return options.`;
    } else if (savingsRatio < 30) {
        retirementText = `You've saved ${savingsRatio.toFixed(1)}% of your retirement goal. Stay consistent with your investments and consider periodic increases.`;
    } else {
        retirementText = `Great progress! You've saved ${savingsRatio.toFixed(1)}% of your retirement goal. Maintain your investment discipline.`;
    }
    
    const investmentRatio = (userData.monthlyInvestment / userData.annualIncome) * 1200;
    if (investmentRatio > 30) {
        retirementText += ` Your required monthly investment (₹${Math.round(userData.monthlyInvestment).toLocaleString('en-IN')}) is ${investmentRatio.toFixed(0)}% of your income, which may be challenging. Consider extending your retirement timeline or finding ways to increase income.`;
    } else if (investmentRatio > 20) {
        retirementText += ` Your required monthly investment (₹${Math.round(userData.monthlyInvestment).toLocaleString('en-IN')}) is ${investmentRatio.toFixed(0)}% of your income. This is manageable with proper budgeting.`;
    } else {
        retirementText += ` Your required monthly investment (₹${Math.round(userData.monthlyInvestment).toLocaleString('en-IN')}) is only ${investmentRatio.toFixed(0)}% of your income, leaving room for additional savings.`;
    }
    
    let emergencyText = '';
    if (userData.emergencyFundCoverage >= 100) {
        emergencyText = `Excellent! Your emergency fund fully covers ${userData.emergencyMonths} months of expenses. Maintain this fund in liquid instruments.`;
    } else if (userData.emergencyFundCoverage >= 50) {
        emergencyText = `Your emergency fund covers ${Math.round(userData.emergencyFundCoverage)}% of the target. Aim for at least 6 months of expenses (₹${userData.targetEmergencyFund.toLocaleString('en-IN')}).`;
    } else {
        emergencyText = `Your emergency fund only covers ${Math.round(userData.emergencyFundCoverage)}% of the target. Prioritize building this to ₹${userData.targetEmergencyFund.toLocaleString('en-IN')} (${userData.emergencyMonths} months of expenses) for financial security.`;
    }
    
    let investmentText = '';
    if (userData.riskAppetite === 'low') {
        investmentText = `With a conservative approach, your portfolio emphasizes stability with higher allocation to debt instruments (${userData.investmentAllocation['Bonds'] || 0}% Bonds, ${userData.investmentAllocation['PPF/EPF'] || 0}% PPF/EPF). Consider adding some growth-oriented options (like equity mutual funds) to potentially enhance returns.`;
    } else if (userData.riskAppetite === 'high') {
        investmentText = `Your aggressive portfolio (${userData.investmentAllocation['Stocks'] || 0}% Stocks, ${userData.investmentAllocation['Mutual Funds'] || 0}% Mutual Funds) aims for higher returns. Ensure you have adequate diversification and consider maintaining some stable investments (like debt funds) for balance.`;
    } else {
        investmentText = `Your balanced portfolio provides growth while managing risk. Regularly rebalance to maintain your target allocation as markets fluctuate.`;
    }
    
    investmentText += ` Remember to utilize tax-saving instruments under Section 80C (like ELSS, PPF) to optimize your returns.`;
    
    userData.insights = {
        retirement: retirementText,
        emergency: emergencyText,
        investment: investmentText
    };
}

function updateResultsUI() {
    try {
        retirementAgeDisplay.textContent = userData.retirementAge;
        lifeExpectancyDisplay.textContent = userData.lifeExpectancy;
        corpusNeededEl.textContent = `₹${Math.round(userData.corpusNeeded).toLocaleString('en-IN')}`;
        currentSavingsDisplay.textContent = `₹${userData.currentSavings.toLocaleString('en-IN')}`;
        corpusGapEl.textContent = `₹${Math.round(userData.corpusGap).toLocaleString('en-IN')}`;
        
        monthlyInvestmentEl.textContent = `₹${Math.round(userData.monthlyInvestment).toLocaleString('en-IN')}`;
        expectedReturnDisplay.textContent = userData.expectedReturn;
        
        insightRetirement.textContent = userData.insights.retirement;
        insightEmergency.textContent = userData.insights.emergency;
        insightInvestment.textContent = userData.insights.investment;
        
        savingsChart.data.labels = userData.savingsProjection.labels;
        savingsChart.data.datasets[0].data = userData.savingsProjection.values;
        savingsChart.update();
    } catch (error) {
        console.error("Error updating results UI:", error);
    }
}

function resetData() {
    currentAgeInput.value = 30;
    retirementAgeInput.value = 60;
    lifeExpectancyInput.value = 85;
    annualIncomeInput.value = 1000000;
    currentSavingsInput.value = 500000;
    monthlyExpensesInput.value = 50000;
    lifestyleInput.value = 'moderate';
    riskAppetiteInput.value = 'moderate';
    expectedReturnInput.value = 12;
    emergencyMonthsInput.value = 6;
    currentEmergencyInput.value = 100000;
    inflationRateInput.value = 5.7;
    
    document.querySelectorAll('.checkbox-item input').forEach(checkbox => {
        checkbox.checked = (checkbox.id === 'mf' || checkbox.id === 'gold');
    });
    
    resultsSection.style.display = 'none';
}

// Initial calculation
setTimeout(() => {
    if (calculateBtn) {
        calculateBtn.click();
    }
}, 500);

window.addEventListener('resize', function() {
    if (savingsChart) savingsChart.resize();
    if (allocationChart) allocationChart.resize();
    if (projectionChart) projectionChart.resize();
    
    const canvas = document.getElementById('matrix-bg');
    if (canvas) {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
});
    </script>
</body>
</html>
